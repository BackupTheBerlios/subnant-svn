<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>

    <title>Using Subversion properties for repository access control</title>

    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
    <meta name="Keywords" content="Subversion,access-control,pre-commit,start-commit,property" />
    <meta name="Description" content="Specification for using Subversion properties in conjunction with pre-commit, start-commit or pre-revprop-change hooks for repository acesss control" />

    <style type="text/css">
        dt { font-weight: bold; }
        .term { border-bottom: 1px dotted black; }
        .margin { margin-left: 1cm; }
    </style>

</head>

<body>

    <h3>Using Subversion properties for repository access control</h3>

    <p>Using <a href="http://svnbook.red-bean.com/en/1.1/ch07s02.html">properties</a>
        in partnership with 
        <a href="http://svnbook.red-bean.com/en/1.1/ch05s02.html#svn-ch-5-sect-2.1">hooks</a>
        and <a href="http://svnbook.red-bean.com/en/1.1/ch05s03.html#svn-ch-5-sect-3.1.1">svnlook</a>,
        we can provide a flexible, granular, visible and version controlled mechanism for
        access control independent of the repository access method.</p>

    <p>Two properties are used.  One to control who can grant rights to change revisions
        properties, and one to control who can change revision properties.  These
        properties can exist on individual files or directories, or on the parent directories
        of files or directories governed by access control.  They do not have to exist in
        tandem in the same location, however all should exist in the repository at the top
        level of the path you wish to control.</p>

    <p>Caveat: This approach does not provide user authentication. The repository access method
        will still need to provide authentication to the server.</p>

    <dl>
        <dt><dfn>property: </dfn><span class="term">admin:revprop-change-access</span></dt>
        <dd>
            <p>::TODO::</p>
        </dd>

        <dt><dfn>property: </dfn><span class="term">hook:revprop-change-access</span></dt>
        <dd>
            <p>This property contains a line delimited list of users permitted to change
                revision properties on the file or directory associated with this property.
                For directories, this permission cascades down to sub-directories and files
                within the sub-directories.</p>

            <p>This property can also explicitly deny access if any user is prefixed with
                an exclamation mark !.</p>

            <p>Each user can also be limited to modify only specific revision properties,
                this is acheived by suffixing an equals sign next to the user, followed by
                a comma separated list of revision properties they are permitted to modify.</p>

            <p>e.g. To grant user <var>admin1</var> rights to modify all revision properties,
                and <var>user1</var> rights to modify svn:log revision property in any part
                of the repository, the <em>hook:revprop-change-access</em> property is set to the
                following values on the repository root:</p>

            <p class="margin"><samp>admin1<br />
                user1=svn:log</samp></p>

            <p>If you wanted to prevent <var>user1</var> from modifying revision properties
                in <samp>/admin-only</samp>, then <var>admin1</var> would set the following
                value to the <em>hook:revprop-change-access</em> property on the
                <samp>/admin-only</samp> directory:</p>

            <p class="margin"><samp>!user1</samp></p>
        </dd>

        <dt><dfn>hook: </dfn><span class="term">pre-commit</span></dt>
        <dd>
            <p>This hook script checks to see if a property is being modified, which can be
                determined by using the <code>svnlook proplist</code> command for the
                transaction being committed. If the <em>admin:revprop-change-access</em>
                or <em>hook:revprop-change-access</em> properties are been modified, the
                user's permission to modify the property is verified. This continues for each
                parent directory , if permission is denied, the search can be abandoned and the
                commit rejected.  If all search paths are exhausted </p>

            <p>Note that whilst the search for <em>admin:revprop-change-access</em> and 
                <em>hook:revprop-change-access</em> should both start on and be performed
                for each file or directory being modified (before working their way up the
                repository path), they are independant and should be treated separately.
                i.e.  A match on <em>admin:revprop-change-access</em> does not stop the
                search for <em>hook:revprop-change-access</em>, and vice versa.</p>
        </dd>

        <dt><dfn>hook: </dfn><span class="term">pre-revprop-change</span></dt>
        <dd>
            <p>This hook script searches HEAD revision for <em>hook:revprop-change-access</em>
                properties on the files and directories being changed in the specified revision. If
                the property is not found, each parent directory back to the repository root is
                searched. If a matching property is found, the user's permission is verified and
                the search is stopped.  If no match is found, permission is denied.</p>
        </dd>

    </dl>

</body>

</html>
