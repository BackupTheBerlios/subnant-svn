<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>

    <title>Using Subversion properties for repository access control</title>

    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
    <meta name="Keywords" content="Subversion,access-control,pre-commit,start-commit,property" />
    <meta name="Description" content="Specification for using Subversion properties in conjunction with pre-commit or start-commit hook for repository acesss control" />

    <style type="text/css">
        dt { font-weight: bold; }
        .term { border-bottom: 1px dotted black; }
    </style>

</head>

<body>

    <h3>Using Subversion properties for repository access control</h3>

    <p>Using <a href="http://svnbook.red-bean.com/en/1.1/ch07s02.html">properties</a>
        in partnership with 
        <a href="http://svnbook.red-bean.com/en/1.1/ch05s02.html#svn-ch-5-sect-2.1">pre-processing hooks</a>
        and <a href="http://svnbook.red-bean.com/en/1.1/ch05s03.html#svn-ch-5-sect-3.1.1">svnlook</a>,
        we can provide a flexible, granular, visible and version controlled mechanism for
        access control independent of the repository access method.</p>

    <p>Two properties are required.  One to control who can give commit rights, and one to control
        who can commit.  These properties can exist on individual files or directories, or on the
        parent directories of files or directories governed by acesss control.  They do not have
        to exist in tandem in the same location, however both should exist in the repository at
        the top path level you wish to control.</p>

    <dl>
        <dt><dfn>property: </dfn><span class="term">hook:commit-access</span></dt>
        <dd>
            <p>This property contains a line delimited list of users who are permitted to commit
                the file or directory of the property in question.  For directories, this permission
                cascades down to sub-directories and files within these sub-directories.</p>

            <p>Conversely, this property can also explicitly deny access if any user is prefixed
                with an exclamation mark !.  This is useful when a user has been given access
                rights higher up the repository path.</p>

            <p>e.g. To give user “admin” and “user1” commit rights to any part of the repository,
                <em>hook:commit-access</em> is set to the following values on
                the repository root:</p>

            <p><samp>admin<br />
                user1</samp></p>
        </dd>

        <dt><dfn>property: </dfn><span class="term">hook:propchange-access</span></dt>
        <dd>
            <p>This property contains a line delimited list of properties.  Each property is
                suffixed with an equals sign followed by a comma delimited list of users 
                permitted to modify the property.</p>

            <p>Conversely, this property can also explicitly deny access if any user is prefixed
                with an exclamation mark !.  This is useful when a user has been given access
                rights higher up the repository path.</p>

            <p>To enable changes to access control, this property needs to set 2 property values,
                the first controls who is allowed to modify the <em>hook:propchange-access</em>
                property, the second controls who is allowed to modify the
                <em>hook:commit-access</em> property.</p>  

            <p>e.g. To give user <var>admin1</var> rights to control who is allowed to modify the 
                <em>hook:propchange-access</em> property, and users <var>admin1</var> and 
                <var>user1</var> rights to modify the <em>hook:commit-access</em> property for
                any part of repository, the <em>hook:propchange-access</em> property is set to
                the following values on the repository root:</p>

            <p><samp>hook:propchange-access=admin1<br />
                hook:commit-access=admin1,user1</samp></p>

            <p>If <var>admin1</var> wanted to prevent <var>user1</var> from modifying who can
                commit to a particular path in the repository, say in the <samp>/admin-only</samp>
                directory, then <var>admin1</var> would set the following value to the
                <em>hook:propchange-access</em> property on the <var>/admin-only</var>
                directory:</p>

            <p><samp>hook:commit-access=!user1</samp></p>

            <p>If <var>admin1</var> also wanted to prevent <var>user1</var> from committing in
                <samp>/admin-only</samp>, then <var>admin1</var> would set the following value to
                the <em>hook:commit-access</em> property on the <samp>/admin-only</samp>
                directory:</p>

            <p><samp>!user1</samp></p>
        </dd>

        <dt><dfn>hook: </dfn><span class="term">pre-revprop-change</span></dt>
        <dd>
            <p>This hook script searches HEAD revision to see if there are any
                <em>hook:propchange-access</em> properties, and if found verifies that
                the user modifying the property is permitted to do so.</p>
        </dd>

        <dt><dfn>hook: </dfn><span class="term">pre-commit</span></dt>
        <dd>
            <p>This hook script searches HEAD revision to see if there are any
                <em>hook:commit-access</em> properties, and if found verifies that
                the user committing the change is permitted to do so.  This hook script
                enables repository, directory or file access control per user.</p>
                
            <p>The hook script should search up the directory tree back to the repository
                root, searching each parent directory for a match.  Properties found higher
                up the directory path have less precedence than those found lower down the
                repository path.  In other words, the value of <em>hook:commit-access</em>
                on a modified file is higher than the value of <em>hook:commit-access</em>
                on it's directory, which is higher than the value of <em>hook:commit-access</em>
                in it's parent directory, and so on.</p>
        </dd>

        <dt><dfn>hook: </dfn><span class="term">start-commit</span></dt>
        <dd>
            <p>This hook script searches HEAD revision to see if there is a
                <em>hook:commit-access</em> property on the repository root, and if found,
                verifies that the user committing the change is permitted to do so.  This hook
                script enables repository access control per user.</p>
        </dd>
    </dl>

</body>

</html>
